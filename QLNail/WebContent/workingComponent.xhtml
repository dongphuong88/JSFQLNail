<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<meta http-equiv="x-ua-compatible" content="ie=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<h:outputStylesheet library="css" name="common.css" />
	<h:outputStylesheet library="css" name="w3.css"></h:outputStylesheet>

	<h:outputScript library="js" name="jquery.formatCurrency-1.4.0.min.js"></h:outputScript>

	<style>
	.ui-datatable .ui-datatable-header, .ui-datatable .ui-datatable-footer {
		text-align: left;
	}
	</style>

	<title>Checkout</title>
</h:head>
<h:body>
	<!-- Date/Time -->
	<div class="w3-container w3-xlarge">
		<label class="w3-label">Date/Time: </label>
		<h:outputText value="#{helperBean.currentDate}">
			<f:convertDateTime pattern="MM/dd/yyyy - hh:mm a" />
		</h:outputText>
	</div>
	<!-- Date/Time END -->
	
	<!-- MainForm -->
	<h:form id="serviceForm" >
		<!-- Services -->
		<p:dataTable id="services">

			<p:ajax event="cellEdit" oncomplete="updateServicesAmount()" />

			<p:column style="width:60px">
				<p:commandButton 
					oncomplete="updateServicesAmount()" icon="fa fa-times"></p:commandButton>
			</p:column>

			<p:column>
				<f:facet name="header">
					<p:commandButton onclick="addService()" value="Add"
						styleClass="w3-left"></p:commandButton>
					<script>
					var rowHtml = '<tr class="ui-widget-content ui-datatable-even"><td style="width:60px"><button class="ui-button ui-widget ui-state-default ui-corner-all ui-button-icon-only"><span class="ui-button-icon-left ui-icon ui-c fa fa-times"></span><span class="ui-button-text ui-c">ui-button</span></button></td><td onclick="serviceEdit(this)"></td><td onclick="staffEdit(this)"></td><td style="width:200px"></td><td style="width:200px"></td></tr>';
					
					function addService() {
						$("#serviceForm\\:services_data").append(rowHtml);
						
					}
					function serviceEdit( obj) {
						if( 0 == $(obj).find('input').length) {
							$(obj).html( '<input class="w3-input" value="'+ $(obj).find('label').text() +'"/>');
							$(obj).find('input').select();
							$(obj).find('input').on( "blur", function() {
								$(obj).html( '<label>'+ $(obj).find('input').val() +'</label>');
							});
						}
					}
					function staffEdit( obj) {
						if( 0 == $(obj).find('input').length) {
							$(obj).html( '<input class="w3-input" value="'+ $(obj).find('label').text() +'"/>');
							$(obj).find('input').select();
							$(obj).find('input').on( "blur", function() {
								$(obj).html( '<label>'+ $(obj).find('input').val() +'</label>');
							});
						}
					}
					</script>
					<h:outputText value="Service" styleClass="w3-center" />
				</f:facet>
			</p:column>

			<p:column headerText="Staff"/>
			<p:column headerText="Amount" style="width:200px"/>
			<p:column headerText="Discount" style="width:200px"/>
			
			<p:columnGroup type="footer">
				<p:row>
					<p:column colspan="3" style="text-align:right" footerText="Totals:" />
					<p:column id="serviceTotal" styleClass="serviceTotal"
						style="text-align:left"></p:column>
				</p:row>

			</p:columnGroup>

		</p:dataTable>
		<!-- Services End -->
		
		<!-- Discount -->
		<p:panelGrid id="discount">
			<f:facet name="footer">
				<p:row>
					<p:column style="text-align:left">
						<h:outputText value="Staff Discount: " />
						<p:selectBooleanButton id="dcStaff" onLabel="Yes"
							offLabel="No" onIcon="ui-icon-check" offIcon="ui-icon-close" />
						<h:outputText styleClass="w3-right" value="Discount :"></h:outputText>
					</p:column>
					<p:column style="text-align:left; width:200px">
						<p:selectBooleanButton styleClass="dcAmount" onLabel="$"
							offLabel="$" >
							<p:ajax update=":serviceForm:discount" />
						</p:selectBooleanButton>
						<p:inputText styleClass="dcInpAmount" onfocus="this.select()" type="number" onchange="updateTotal()"
							style="width:100px"></p:inputText>
						<p:selectBooleanButton styleClass="dcPercent" onLabel="%"
							offLabel="%" >
							<p:ajax update=":serviceForm:discount" />
						</p:selectBooleanButton>
						<p:inputText styleClass="dcInpPercent" type="number" onchange="updateTotal()"
							style="width:100px"></p:inputText>
					</p:column>
				</p:row>
			</f:facet>
		</p:panelGrid>
		<!-- Discount End -->
		
		<!-- Transaction -->
		<div class="w3-container w3-half w3-xlarge"></div>
		<div class="w3-container w3-half">
			<p:panelGrid style="margin-top:10px; margin-bottom:10px">
				<p:row>
					<p:column style="width:100px">Tip:</p:column>
					<p:column>
						<p:inputText styleClass="tip" type="number" onchange="updateTotal()" onfocus="$(this).select()"></p:inputText>
					</p:column>
				</p:row>
				<p:row>
					<p:column>Total:</p:column>
					<p:column>
						<h:outputText styleClass="total" value="$0.00"></h:outputText>
					</p:column>
				</p:row>
				<p:row>
					<p:column>Pay by:</p:column>
					<p:column id="payType" styleClass="payType">
						<div>
							<p:selectBooleanButton onchange="clickPayType(this)" styleClass="cash payTypeHide" value="cash" onLabel="Cash" offLabel="Cash"></p:selectBooleanButton>
							<p:inputText styleClass="inpCash payTypeHide" onfocus="$(this).select()" style="width:100px; display:none" type="number" value="0.00"></p:inputText>
							<p:selectBooleanButton onchange="clickPayType(this)" styleClass="credit payTypeHide" value="cash" onLabel="Credit" offLabel="Credit"></p:selectBooleanButton>
							<p:inputText styleClass="inpCredit payTypeHide" onfocus="$(this).select()" style="width:100px; display:none" type="number" value="0.00"></p:inputText>
							<p:selectBooleanButton onchange="clickPayType(this)" styleClass="gift payTypeHide" value="cash" onLabel="Gift" offLabel="Gift"></p:selectBooleanButton>
							<p:inputText styleClass="inpGiftNo payTypeHide" onfocus="$(this).select()" style="width:100px; display:none" value=""></p:inputText>
							<p:inputText styleClass="inpGift payTypeHide" onfocus="$(this).select()" style="width:100px; display:none" type="number" value="0.00"></p:inputText>
							<p:commandButton value="Add Pay" styleClass="w3-right" onclick="addPay()">
						        <script>
						        	function addPay() {
						        		var html = '<div style="padding-top:5px">'
						        		+'<div type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only credit payTypeHide" >'
						        		+'<label class="ui-button-text ui-c">'
						        		+'<input style="display:none" type="checkbox" onchange="clickPayType(this);$(this).parent().parent().toggleClass(\'ui-state-active\')"/>'
						        		+'Credit</label></div>'
						        		+'<input type="number" value="0" onfocus="$(this).select()" style="width:100px; display:none" class="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all inpCredit payTypeHide" role="textbox" aria-disabled="false" aria-readonly="false"/>'
						        		+'<div type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only gift payTypeHide" >'
						        		+'<label class="ui-button-text ui-c">'
						        		+'<input style="display:none" type="checkbox" onchange="clickPayType(this);$(this).parent().parent().toggleClass(\'ui-state-active\')"/>'
						        		+'Gift</label></div>'
						        		+'<input value="" onfocus="$(this).select()" style="width:100px; display:none" class="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all inpGiftNo payTypeHide" role="textbox" aria-disabled="false" aria-readonly="false"/>'
						        		+'<input type="number" value="0" onfocus="$(this).select()" style="width:100px; display:none" class="ui-inputfield ui-inputtext ui-widget ui-state-default ui-corner-all inpGift payTypeHide" role="textbox" aria-disabled="false" aria-readonly="false"/>'
						        		+'<div onclick="$(this).parent().remove()" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only w3-right" aria-disabled="false">'
						        		+'<span class="ui-button-text ui-c">Delete</span></div>'
						        		+'</div>';
										$('.payType').append(html);
						        	}
						        </script>
						    </p:commandButton>
						</div>
						<script>
							function clickPayType( obj) {
								var row = $(obj).parent().parent().parent();
								$(row).find('.payTypeHide').hide();
								if( $(obj).parent().parent().hasClass('cash')) {
									if( $(obj).prop('checked')) {
										$(row).find('.cash, .inpCash').show();
									}
									else {
										$(row).find('.cash, .credit, .gift').show();
									}
								}
								else if ( $(obj).parent().parent().hasClass('credit')){
									if( $(obj).prop('checked')) {
										$(row).find('.credit, .inpCredit').show();
									}
									else {
										$(row).find('.cash, .credit, .gift').show();
									}
								}
								else if( $(obj).parent().parent().hasClass('gift')){
									if( $(obj).prop('checked')) {
										$(row).find('.gift, .inpGift, .inpGiftNo').show();
									}
									else {
										$(row).find('.cash, .credit, .gift').show();
									}
								}
							}
						</script>
					</p:column>
				</p:row>
			</p:panelGrid>
		</div>
		<!-- Transaction END -->
		
		<!-- Action -->
		<div class="w3-center w3-container">
			
			<p:commandButton style="width:180px;height:50px;" value="Print" actionListener="#{checkoutBean.print}"></p:commandButton>
			<p:commandButton style="width:180px;height:50px;" value="Email"></p:commandButton>
		</div>
		<!-- Action END-->
		
	</h:form>
	<!-- MainForm END -->
	
	<h:outputScript library="js" name="common.js"></h:outputScript>
	<script>
		$(function() {
			// clear table
			$("#serviceForm\\:services_data").html("");
			updateServicesAmount();
		});

		function updateServicesAmount() {
			var total = 0;
			$('.serviceAmount').each(function(index) {
				total += parseFloat($(this).text().replace(/\\$|,/g, ''));
			});
			$('.serviceTotal').text(total);
			$('.serviceTotal').formatCurrency();

			updateTotal();
		}

		function updateTotal() {
			// services
			var serviceAmount = parseFloat($('.serviceTotal').text().replace(
					/\\$|,/g, ''));
			// Discount
			var dcAmount;
			if ($('.dcPercent').hasClass('ui-state-active')) {
				dcAmount = +$('.dcInpPercent').val() * serviceAmount / 100;
			} else {
				dcAmount = +$('.dcInpAmount').val();
			}
			if( isNaN(dcAmount))
				dcAmount = 0;
			// tip
			var tip = +$('.tip').val();
			
			$('.total').text( serviceAmount + dcAmount + tip);
			$('.total').formatCurrency();
		}

		function selectDCAmount() {
			if ($('.dcAmount').hasClass('ui-state-active')) {
				$('.dcPercent').removeClass('ui-state-active');
				$('.dcPercent input').prop("checked", false);
				$('.dcPercent').hide();
				$('.dcInpAmount').show();

				$('.dcInpAmount').focus();
			} else {
				$('.dcPercent').show();
				$('.dcInpAmount').hide();
			}
		}
		function selectDCPercent() {
			if ($('.dcPercent').hasClass('ui-state-active')) {
				$('.dcAmount').removeClass('ui-state-active');
				$('.dcAmount input').prop("checked", false);
				$('.dcAmount').hide();
				$('.dcInpPercent').show();
			} else {
				$('.dcAmount').show();
				$('.dcInpPercent').hide();
			}
		}
		
		function selectCash( row) {
			if ($('.cash').hasClass('ui-state-active')) {
				$('.credit, .gift').removeClass('ui-state-active');
				$('.credit input, .gift input').prop("checked", false);
				$('.credit, .gift').hide();
				$('.cashInp').show();

			} else {
				$('.credit, .gift').show();
				$('.cashInp').hide();
			}
		}
	</script>
</h:body>
</html>