<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
	<meta http-equiv="x-ua-compatible" content="ie=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

	<h:outputStylesheet library="css" name="common.css" />
	
	<style>
		.ui-datatable .ui-datatable-header, .ui-datatable .ui-datatable-footer {
			text-align:left;
		}
	</style>
	<title>Insert title here</title>
</h:head>
<h:body>

<div>
	<h3><label class="w3-label">Date/Time: </label>
	<h:outputText value="#{checkoutBean.currDateTime}" /></h3>
</div>

<h:form id="serviceForm" style="height:100%">
		<p:dataTable id="services" var="service" value="#{checkoutBean.services}">
			<p:column style="width:100px;text-align: center;padding:0px;">
	             <p:commandButton update=":serviceForm:editServiceDialogID" oncomplete="PF('editServiceDialogVar').show()" icon="ui-icon-pencil" title="Edit">
	                <f:setPropertyActionListener value="#{service}" target="#{checkoutBean.editTransactionService}" />
	            </p:commandButton>
	            <p:commandButton update=":serviceForm:services" actionListener="#{checkoutBean.deleteTransactionService(service)}" icon="ui-icon-closethick" title="Delete">
	            </p:commandButton>
	        </p:column>
			<p:column headerText="Service">
				<h:outputText value="#{service.serviceName}" />
			</p:column>
			<p:column headerText="Employee">
				<h:outputText value="#{service.employeeName}" />
			</p:column>
			<p:column headerText="Amount">
				<h:outputText value="#{service.amount}" >
					<f:convertNumber currencySymbol="$" type="currency"/>
				</h:outputText>
			</p:column>
			<p:columnGroup type="footer">
				<p:row>
					<p:column colspan="3" style="text-align:right" footerText="Totals:" />
					<p:column styleClass="serviceTotal" style="text-align:left"
						footerText="#{checkoutBean.totalServiceAmount}" >
						</p:column>
				</p:row>
			</p:columnGroup>
			<f:facet name="footer">
				<p:commandButton onclick="PF('newServiceDialogVar').show();$('#serviceForm\\:addServicePanel input').val('');" value="Add Service" id="btnAddService" icon="ui-icon-circle-plus" />
				
			</f:facet>
		</p:dataTable>

		<p:dialog id="newServiceDialogID" position="center" widgetVar="newServiceDialogVar" header="Add New Service"
			modal="true" showEffect="fade" hideEffect="fade" resizable="false" >
			<h:panelGrid columns="2" cellpadding="0" id="addServicePanel">
				<p:outputLabel value="Service:" for="txtNewService" />
				<p:inputText id="txtNewService" placeholder="Enter Service" value="#{checkoutBean.newTransactionService.serviceName}"></p:inputText>
				
				<p:outputLabel value="Employye:" for="txtNewEmployee" />
				<p:inputText id="txtNewEmployee" placeholder="Enter Employee" value="#{checkoutBean.newTransactionService.employeeName}"></p:inputText>
				
				<p:outputLabel value="Amount:" for="txtNewAmount" />
				<p:inputText id="txtNewAmount" placeholder="Enter Amount" type="number"  value="#{checkoutBean.newTransactionService.amount}"></p:inputText>
				
				<p:commandButton update=":serviceForm:services"  onclick="PF('newServiceDialogVar').hide();" actionListener="${checkoutBean.addServiceRow()}" value="Add" icon="ui-icon-circle-plus" />
				<p:commandButton onclick="PF('newServiceDialogVar').hide();" value="Cancel" icon="ui-icon-circle-plus" />
			</h:panelGrid>
		</p:dialog>
		
		<p:dialog id="editServiceDialogID" position="center" widgetVar="editServiceDialogVar" header="Edit Service"
			modal="true" showEffect="fade" hideEffect="fade" resizable="false">
			<h:panelGrid columns="2" cellpadding="0" id="editServicePanel">
				<p:outputLabel value="Service:" for="txtEditService" />
				<p:inputText id="txtEditService" placeholder="Enter Service" value="#{checkoutBean.editTransactionService.serviceName}"></p:inputText>
				
				<p:outputLabel value="Employye:" for="txtEditEmployee" />
				<p:inputText id="txtEditEmployee" placeholder="Enter Employee" value="#{checkoutBean.editTransactionService.employeeName}"></p:inputText>
				
				<p:outputLabel value="Amount:" for="txtEditAmount" />
				<p:inputText id="txtEditAmount" placeholder="Enter Amount" type="number"  value="#{checkoutBean.editTransactionService.amount}"></p:inputText>
				
				<p:commandButton update=":serviceForm:services" actionListener="#{checkoutBean.updateServicesAmount()}" onclick="PF('editServiceDialogVar').hide();" value="Save" icon="ui-icon-circle-plus" />
				<p:commandButton onclick="PF('editServiceDialogVar').hide();" value="Cancel" icon="ui-icon-circle-plus" />
			</h:panelGrid>
		</p:dialog>
	</h:form>
	
	<h:outputScript library="js" name="common.js"></h:outputScript>
	<script>
		function updateServiceTotal() {
			var total = 0;
			$("#form .serviceAmount").each( function() {
				//var amount = $(this).text().substring(1, $(this).text().length).replace(",","");
				
				total += +$(this).val();//parseFloat(amount);
			} );
			$("#form .serviceTotal").html("$" + total.toFixed(2).replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,"));
			
			
		}
	</script>
</h:body>
</html>